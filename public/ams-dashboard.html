<!-- chat application intro page -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/index.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <title>SarasCare | AMS-Dashboard</title>
     <style>
.table-container {
  margin: 20px auto;
  padding: 15px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  min-height: 300px;
  /* No width or max-width restriction */
}
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  /* No width or max-width restriction */
}
#usersTable {
  width: auto;
  min-width: 100%;
  border-collapse: collapse;
  font-family: Arial, sans-serif;
  font-size: 14px;
  table-layout: auto;
  background: #fff;
}
#usersTable th, #usersTable td {
  border: 1px solid #e0e0e0;
  padding: 10px 12px;
  text-align: left;
  vertical-align: top;
  white-space: normal;
  word-break: break-word;
  transition: background 0.2s;
  /* Remove max-width restriction */
}
#usersTable th {
  background: #1976d2;
  color: #fff;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 2;
}
#usersTable tr:nth-child(even) {
  background: #f5f7fa;
}
#usersTable tr:nth-child(odd) {
  background: #fff;
}
#usersTable tr:hover {
  background: #e3f2fd;
}
@media (max-width: 900px) {
  .table-container {
    padding: 8px;
  }
  #usersTable th, #usersTable td {
    padding: 8px 6px;
    font-size: 13px;
  }
}
@media (max-width: 600px) {
  .table-container {
    padding: 2px;
    min-width: 320px;
  }
  #usersTable th, #usersTable td {
    padding: 6px 4px;
    font-size: 12px;
  }
  #usersTable th {
    font-size: 13px;
  }
  .table-responsive {
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }
}

#button,#button2 {
    background-color: rgb(201, 35, 10); 
    color: rgb(255, 255, 255); 
    border: 2px solid #000000;
    border-radius: 10px;
    padding:10px;
    margin-top:20px;
    }

    #button:hover,#button2:hover {
    background-color:rgb(255, 255, 255);
    color: rgb(0, 0, 0);
    }
</style>
</head>
<body>
    <!-- <div class="intro_container">
        <div class="intro_content intro_row">
            <div class="intro_col">
                <div class="intro_title"> -->
                    <center>
                      <img style="height:130px;width:250px;margin-top: 50px;" src="/images/logo (2).png" alt="Logo"/> 
                      <h1>AMS Dashboard</h1>
                      <h2>Team Savaliya Technology's Attendance Data</h2>
                        <center>
                            <button  class="btns" id="button">Reset</button>
                        </center>  
                    </center>

                   
                <!-- <span>Team SarasCare Attendance Data</span>
                </div>
                <div class="intro_form"> -->
                    
                <!-- </div> -->
                     <div class="table-container">
                        <div class="table-responsive">
                            <table id="usersTable">
                                <thead>
                                    <!-- <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Course</th>
                                    <th>Campus</th>
                                    <th>Unit</th>
                                    <th>Week/Day</th>
                                    <th>Logs</th>
                                    </tr> -->
                                    <th>Email</th>
                                    <th>Week/Day</th>
                                    <th>Logs</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
        
            <!-- <div class="intro_col">
                <img src="images/logo.png" alt="logo">
            </div> -->
        <!-- </div>
    </div> -->


    <!-- <script id="rooms_template" type="text/html">
        {{#rooms}}
          <option>{{.}}</option>
        {{/rooms}}
    </script>

    <script src="socket.io/socket.io.js"></script>
    <script src="js/getRooms.js"></script> -->

   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.6.0/qs.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
     <script type="text/javascript">
    
 function clearDB()
        {
            // const datetime = getFormattedDateTime();

            $.ajax({
                url: "/api/cleardb",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                action: "clr"
                }),
                success: function(res) {
                  if(res.success){
                    alert("Database cleared successfully.");
                    location.reload();
                  } else {
                    alert("Failed to clear database: " + res.error);
                  }
                
                },
                error: function(err) {
                alert("API error:", err);
                }
            });
        }
    $(document).ready(function() {
        const captureBtn = document.getElementById("button");
        captureBtn.addEventListener("click", () => {
          console.log("Clear DB button clicked");
          clearDB();
        });

      $.get("/api/usersdata", function(users) {
        const tbody = $("#usersTable tbody");
        tbody.empty();
console.log(users);
    users.forEach(user => {
      let weekDayColumn = "";
      let logsColumn = "";
      
    if (user.Logs && user.Logs.length) {
        const logsPerWeek = 4; // 2 days * 2 logs per week
        for (let i = 0; i < user.Logs.length; i += 2) {
            // const week = Math.floor(i / logsPerWeek) + 1;
            // const day = Math.floor((i % logsPerWeek) / 2) + 1;

            const signIn = user.Logs[i] ? user.Logs[i].datetime : "-";
            const signOff = user.Logs[i + 1] ? user.Logs[i + 1].datetime : "Logged-In";

          //console.log(typeof(signOff));
            //console.log(user.Logs[i].datetime);
            // weekDayColumn += `Week-${week} Day-${day}<br/>`;
            weekDayColumn += user.Logs[i].datetime;
            logsColumn += `${signIn} => ${signOff}<br/>`;
        }
    } else {
        weekDayColumn = "No logs";
        logsColumn = "No logs";
    }

    
    const row = `
        <tr>
            <td>${user.UserEmail || ""}</td>
            <td>${weekDayColumn}</td>
            <td>${logsColumn}</td>
        </tr>
    `;
    // const row = `
    //     <tr>
    //         <td>${user.First_Name || ""} ${user.Last_Name || ""}</td>
    //         <td>${user.UserEmail || ""}</td>
    //         <td>${user.Course || ""}</td>
    //         <td>${user.Campus || ""}</td>
    //         <td>${user.Unit || ""}</td>
    //         <td>${weekDayColumn}</td>
    //         <td>${logsColumn}</td>
    //     </tr>
    // `;

    $("#usersTable tbody").append(row);
});

      });});

    </script>
</body>
</html>